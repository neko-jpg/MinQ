

### チェックリストA（UI/UX・機能改善中心）

-   [x] **テーマ & トークン (基盤設計)**
    -   [x] **テーマ集約**: `ThemeData`にColor/Typo/Spacing/Radius/Elevationを集約する。
    -   [x] **カラー定義**:
        -   [x] 紫系カラーを撤去し、アクセントを水色系に統一する。
        -   [x] ライト/ダーク両テーマのトークンを定義する（ライトテーマは水色の彩度を+10〜15%向上させる）。
    -   [x] **スタイル統一**:
        -   [x] アイコンの線幅を `2px` 相当で統一する。
        -   [x] カードのスタイルは、影 (`Elevation`) または枠線 (`Outline`) のどちらか一方に統一する（ダークテーマでは枠線を推奨）。
-   [x] **コピー & ローカライズ (文言)**
    -   [x] **言語統一**: アプリ内の言語を**日本語に完全統一**する。
    -   [x] **マイクロコピー**: CTA（行動喚起）の文言を「（動詞）する」形式に統一する。
    -   [x] **国際化対応**: `intl`パッケージを導入し、複数形（1日/2日...）に対応 (`plural`/`select`)。
    -   [x] **規約整備**: 同意文、利用規約、プライバシーポリシーを日本語で整備し、リンク色のコントラストを確保する (WCAG AA基準)。
-   [x] **レイアウト & タイポグラフィ (骨格)**
    -   [x] **8dpグリッド**: 全てのコンポーネントの余白を8の倍数で徹底する。
    -   [x] **タイプスケール**: H1/H3/Body/Button等のフォントサイズと太さを固定する。
    -   [x] **タップ領域**: 全てのタップ可能要素の最小サイズを **48x48dp** に保証する（必要ならヒットボックスを拡張）。
    -   [x] **レスポンシブ対応**:
        -   [x] 大画面端末ではコンテンツの最大幅を `640dp` に制限し、左右に余白を設ける。
        -   [x] **ジェスチャー競合回避**: Androidのジェスチャーナビゲーションと競合しないよう、画面下端に常時 **24–32dp** の安全な余白（セーフエリア）を確保する。
-   [x] **コンポーネント状態 (振る舞い)**
    -   [x] **ボタン状態定義**: 全てのボタンに `default`/`pressed`/`focused`/`disabled`/`loading` の5状態を定義する（`pressed`時は背景を10〜15%暗くするなど）。
    -   [x] **ローディング表現**: ローディング中のレイアウト崩れを防ぐため、スケルトン表示を基本とし、ボタン内ではスピナーを使用する。
    -   [x] **グラフの0件表示**: グラフのデータが0件の場合の専用表示（例: 薄いトラック表示＋「データがありません」＋行動喚起ボタン）を用意する。
    -   [x] **ホーム**:
        -   [x] レイアウトを「ヒーローカード1枚 ＋ 2列カード（ミニクエスト/今日の進捗）」に再構成する。
        -   [x] KPIメーター（円グラフ）の0表示時の重なりを解消する。
        -   [x] カード内のテキストは最大2行までに制限し、超過分は「もっと見る」で対応する。
    -   [x] **進捗 (Stats)**:
        -   [x] 主KPIを「現在の連続日数」とし、「目標設定」は行アイテムに変更（タップでボトムシート編集）。
        -   [x] グラフの凡例、単位、先週との差分（例: `▲1日`）の表示を統一する。
    -   [x] **ペア (Pair)**:
        -   [x] CTAボタンを `SafeArea` 内に配置し、最下部に **24–32dp** の余白を確保する。
        -   [x] **安全対策**: ユーザー詳細画面に**「通報」「ブロック」**の導線を常設する。
    -   [x] **クエスト一覧**:
        -   [x] カードタイトルは2行まで、サブタイトルは1行まで表示可能にする。
        -   [x] タブを「おすすめ / 自分の / 学習 / 最近」などに再編する。
    -   [x] **新しい習慣追加画面**:
        -   [x] 画面全体を横スクロールできるように実装する。
    -   [x] **設定**:
        -   [x] 「アカウント削除」は**チェックボックス同意＋長押し確定**の2段階操作にする。
        -   [x] 開発者向けオプションはバージョン番号の連続タップで表示される隠し機能にする。
-   [x] **ナビ & 遷移 (画面遷移)**
    -   [x] **ボトムナビ**:
        -   [x] タブ項目は最大5つまでとする。
        -   [x] タブの連続タップによる画面の二重起動を抑制する (`throttle 500ms`)。
    -   [x] **戻る動作**: OS標準の「戻る」操作と、ヘッダーの「戻る」ボタンの挙動を常に一致させる。
    -   [x] **ディープリンク**: 通知などから特定のクエスト詳細画面へ直接遷移できるよう、`app://quest/{id}` のようなスキーマを実装する。
-   [x] **フィードバック & 通知 (応答)**
    -   [x] **インジケータ統一**: 成功時は短いトースト（1.5秒）、失敗時はアクション付きスナックバー（3秒）でフィードバックする。
    -   [x] **ハプティクス**: ユーザーの達成感を高めるため、クエスト完了時などに軽い振動 `lightImpact()` を実行する。
    -   [x] **通知設計**:
        -   [x] **通知チャンネル (Android)**: 「リマインダー」「ペア」「システム」でチャンネルを分割し、ユーザーが個別設定できるようにする。
        -   [x] **許諾タイミング**: 通知の価値をユーザーに伝えた後（初回クエスト完了後など）に、許諾ダイアログを提示する。
    -   [x] **インアプリレビュー**: 初回達成から7日継続時など、ユーザーがポジティブな体験をした直後に限定してレビューを依頼する。
-   [ ] **アクセシビリティ (A11y)**
    -   [x] **色覚多様性**: 主要な指標は**色だけでなく、形やアイコンを併用**して誰でも判別できるようにする。
    -   [x] **テキスト拡大**: OSのフォント設定を**200%**にしても、主要なボタンやナビゲーションの表示が崩れないことを確認する。
    -   [x] **読み上げ順序**: `Semantics`ウィジェットでスクリーンリーダーの読み上げ順を最適化する。
    -   [x] **動きの抑制**: OSの「動きを減らす」設定が有効な場合、アニメーションをシンプルなフェードに限定する。
-   [x] **パフォーマンス (速度・品質)**
    -   [x] **リスト描画**: 長いリストには `ListView.builder` や `Sliver` を使用し、パフォーマンスを最適化する。
    -   [x] **再描画抑制**: グラフなど、頻繁に更新される部分は `RepaintBoundary` で囲み、不要な再描画を防ぐ。
    -   [x] **画像最適化**: `cacheWidth`/`height`を指定し、SVGは固定サイズで描画することで、画像のぼやけやガタつきを防ぐ。
    -   [x] **高リフレッシュレート**: 120Hz等の高リフレッシュレート端末で、アニメーションやスクロールにちらつきがないか実機で確認する。
-   [x] **オフライン & 整合性 (安定性)**
    -   [x] **キャッシュ戦略**: ホーム画面や進捗画面は、まずローカルキャッシュを即時描画し、その後バックグラウンドで最新データを取得する。
    -   [x] **同期表示**: オフラインから復帰した際に「同期が完了しました」などのバナーを表示し、ユーザーに安心感を与える。
    -   [x] **エラー境界**: アプリがクラッシュした場合に備え、次回起動時に「状態を復元しますか？」と尋ねる専用のエラー画面を用意する。
-   [x] **セキュリティ & プライバシー (信頼性)**
    -   [x] **ポリシー明記**: Pair機能の利用規約に、未成年のやり取りに関する禁止事項などを明記する。
    -   [x] **データ保護**: アカウント削除が不可逆であることを明確に伝え、2段階の確認を徹底する。
    -   [x] **情報マスキング**: スクリーンショットや画面録画時に、個人情報（メールアドレス等）が映り込まないようマスキングする方針を定める。
-   [x] **分析 & 運用 (継続改善)**
    -   [x] **イベント命名規則**: アナリティクスイベントは `verb_object` (例: `create_quest`) の形式で統一する。
    -   [x] **運用目標設定**: **Crash-free sessions > 99.5%** を目標とし、週次でモニタリングする。
    -   [x] **ヘルプ充実**: バッテリー最適化によって通知が届かないユーザー向けに、OSの設定変更手順を案内するページを用意する。
    -   [x] **QAマトリクス**: リリース前のテストは、最低でも「画面サイズ3種 × 2テーマ × 2言語 × フォント拡大」の組み合わせで実施する。

---

### チェックリストB（技術的負債解消・実装中心）

-   [x] **ビルド安定化 & 静的解析**
    -   [x] `flutter clean && flutter pub get` で依存解決を正常化（ビルドログを `build_environment_diagnosis.md` に貼る）
    -   [x] `analysis_options.yaml` を `package:flutter_lints` 準拠に更新＋`prefer_const_constructors, always_use_package_imports, public_member_api_docs` を有効化
    -   [x] `import` の相対→パッケージ経路へ統一（例: `package:minq/...`）
-   [x] **アプリ初期化の堅牢化（Firebase/エラーハンドリング）**
    -   [x] `main.dart` の初期化フローを try-catch でラップし、失敗時は**限定機能モード**（オフライン/記録のみ）にフォールバック
    -   [x] `firebase_options.dart` の環境分離（dev/stg/prod）と `.env.json` 読み込み（flavor対応）
    -   [x] `AuthRepository` で `FirebaseAuthException` マッピング（ユーザー可読メッセージ化）
-   [x] **ルーティング & 戻る動作（GoRouter整備）**
    -   [x] `app_router.dart` のネームドルート定数化＋画面遷移用のユースケース層関数を追加（生 `context.go` 直書きを削減）
    -   [x] ディープリンク/共有リンクの URI 仕様を定義（`/pair/matching?code=...`）
-   [x] **テーマ/デザイン・トークンの集約**
    -   [x] `MinqTheme` を**設計トークン**化：`color, spacing, radius, elevation, typography` を `ThemeExtension` で一元管理
    -   [x] ライト/ダークの配色再設計（紫(RGB(57, 80, 132))撤去→アクセントを水色(RGB(55, 203, 250))系）＋コントラスト AA 満たす
    -   [x] アイコン線幅 2px 統一、カードは「枠線(outline)」へ寄せる（ダークで視認性↑）
-   [ ] **文言/ローカライズ（日本語完全対応）**
    -   [ ] `l10n` ARB を整理し、全テキストをコード内直書き禁止
    -   [ ] CTA を「（動詞）する」形式に統一（例: `開始する`, `共有する`）
    -   [ ] エラーメッセージのトーン統一（丁寧体/ガイドリンク付）
-   [x] **アクセシビリティ（A11y）**
    -   [x] 最小タップ領域 48dp、ListTile/ボタンの `minSize` を共通化
    -   [x] フォント拡大（200%）でレイアウト崩壊しないか手動/ゴールデンテスト追加
    -   [x] `Semantics` / `Tooltip` 付与（アイコンボタン全般）
-   [x] **データ層/状態管理（Riverpod）**
    -   [x] Provider の命名規則統一（`xxxRepositoryProvider`, `xxxUsecaseProvider`）と依存の循環チェック
    -   [x] Repository の I/F と実装分離（`abstract class` + `impl`）でモック容易化
    -   [x] 長時間 Stream の `listen` を `ref.onDispose` で必ず解放
-   [x] **画面ごとの UX 改善（抜粋）**
    -   [x] ペアマッチング：マッチ中インジケータ＋キャンセル導線、タイムアウト時の再試行
    -   [x] チャット：メッセージ送信失敗時のリトライ/オフラインキュー
    -   [x] ホーム：骨組みスケルトン（`minq_skeleton.dart`）適用で体感速度↑
-   [x] **通知・共有の堅牢化**
    -   [x] `NotificationService` の権限ダイアログと「あとで」を実装（1週間後に再提示）
    -   [x] 共有機能：`ShareService` のファイル I/O を try-catch、容量/失敗時の案内をスナックで表示
-   [x] **監視/計測/ログ**
    -   [x] `minq_logger.dart` のレベル設計（debug/info/warn/error）＋PIIマスク（email, uid）
    -   [x] Crashlytics/Analytics のイベント命名を `verb_object` で統一（例: `create_quest`, `start_pair`）
-   [x] **セキュリティ/ポリシー**
    -   [x] アカウント削除は二重確認＋ 7日間の復元猶予を明示（規約追記）
    -   [x] Pair機能の年齢ガード/通報導線/ブロックを実装（UI上に明示）
-   [x] **テスト/CI**
    -   [x] ユニット（Repository/Usecase）最低10本、Widgetテスト（主要画面）最低3本
    -   [x] GitHub Actions（またはCodemagic）で `analyze/test/build` のCI
-   [ ] **リリース前チェック**
    -   [ ] QA マトリクス：`3画面サイズ × 2テーマ × 2言語 × フォント拡大` を網羅
    -   [ ] ストア用プライバシー/安全性フォームの準備（Android Data safety/iOS Privacy）
