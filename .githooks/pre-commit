#!/bin/sh

# Pre-commit hook for Flutter project
# This hook runs format, lint, and test before committing

echo "ğŸ” Running pre-commit checks..."

# Format check
echo "ğŸ“ Checking code formatting..."
dart format --set-exit-if-changed lib test
if [ $? -ne 0 ]; then
  echo "âŒ Code formatting failed. Please run 'dart format lib test' to fix."
  exit 1
fi
echo "âœ… Code formatting passed"

# Analyze
echo "ğŸ” Running static analysis..."
flutter analyze
if [ $? -ne 0 ]; then
  echo "âŒ Static analysis failed. Please fix the issues above."
  exit 1
fi
echo "âœ… Static analysis passed"

# Check for unused imports
echo "ğŸ§¹ Checking for unused imports..."
dart run dart_code_metrics:metrics check-unused-files lib
if [ $? -ne 0 ]; then
  echo "âš ï¸  Unused files detected. Consider removing them."
  # Don't fail the commit for this
fi

# Run tests
echo "ğŸ§ª Running tests..."
flutter test
if [ $? -ne 0 ]; then
  echo "âŒ Tests failed. Please fix the failing tests."
  exit 1
fi
echo "âœ… Tests passed"

echo "âœ¨ All pre-commit checks passed!"
exit 0
