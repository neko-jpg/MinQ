# TODO・技術的負債の管理

このドキュメントは、プロジェクト内のTODOと技術的負債を管理するためのものです。

## 目次

1. [優先度の定義](#優先度の定義)
2. [現在のTODO](#現在のtodo)
3. [技術的負債](#技術的負債)
4. [将来の改善](#将来の改善)
5. [完了したタスク](#完了したタスク)

---

## 優先度の定義

### P0（クリティカル）
- **期限**: 即座に対応
- **影響**: サービス停止、データ損失、セキュリティ脆弱性
- **例**: クラッシュバグ、データ破損、セキュリティホール

### P1（高）
- **期限**: 1週間以内
- **影響**: 主要機能の不具合、ユーザー体験の大幅な低下
- **例**: 主要機能のバグ、パフォーマンス問題

### P2（中）
- **期限**: 1ヶ月以内
- **影響**: 一部機能の不具合、ユーザー体験の軽微な低下
- **例**: マイナーなバグ、UI の改善

### P3（低）
- **期限**: 3ヶ月以内
- **影響**: 開発効率の改善、コード品質の向上
- **例**: リファクタリング、ドキュメント整備

### P4（将来）
- **期限**: 未定
- **影響**: Nice to have な機能
- **例**: 新機能のアイデア、実験的な機能

---

## 現在のTODO

### P0（クリティカル）

現在なし

### P1（高）

#### 1. 通知システムの改善
- **場所**: `lib/core/notifications/push_notification_handler.dart`
- **内容**: バックグラウンドでの通知処理が不安定
- **影響**: ユーザーが通知を受け取れない
- **対応策**: WorkManager を使用した確実な配信
- **担当**: 未定
- **期限**: 2025-10-15

#### 2. データ同期の最適化
- **場所**: `lib/data/repositories/quest_log_repository.dart`
- **内容**: 大量のクエストがある場合に同期が遅い
- **影響**: アプリの応答性が低下
- **対応策**: ページネーション、インクリメンタル同期
- **担当**: 未定
- **期限**: 2025-10-20

### P2（中）

#### 1. エラーハンドリングの統一
- **場所**: 複数ファイル
- **内容**: エラーハンドリングが統一されていない
- **影響**: デバッグが困難、ユーザーへのフィードバックが不十分
- **対応策**: エラーハンドリングのベストプラクティスを策定
- **担当**: 未定
- **期限**: 2025-11-01

#### 2. テストカバレッジの向上
- **場所**: `test/`
- **内容**: テストカバレッジが60%程度
- **影響**: バグの早期発見が困難
- **対応策**: 主要機能のテストを追加
- **担当**: 未定
- **期限**: 2025-11-15

#### 3. パフォーマンスの最適化
- **場所**: `lib/presentation/screens/stats_screen.dart`
- **内容**: グラフ描画が重い
- **影響**: 画面遷移が遅い
- **対応策**: キャッシュ、遅延読み込み
- **担当**: 未定
- **期限**: 2025-11-30

### P3（低）

#### 1. コードの整理
- **場所**: 複数ファイル
- **内容**: 未使用のコード、コメントアウトされたコードが残っている
- **影響**: コードの可読性が低下
- **対応策**: 定期的なコードレビュー、linter の強化
- **担当**: 未定
- **期限**: 2025-12-31

#### 2. ドキュメントの充実
- **場所**: `docs/`
- **内容**: API ドキュメント、コンポーネントドキュメントが不足
- **影響**: 新規メンバーのオンボーディングが困難
- **対応策**: dart doc の充実、Storybook の導入
- **担当**: 未定
- **期限**: 2025-12-31

---

## 技術的負債

### 高優先度

#### 1. Riverpod の移行
- **現状**: 一部で古い Provider パターンを使用
- **理想**: すべて Riverpod 2.0 の最新パターンに統一
- **影響**: メンテナンス性の低下
- **工数**: 3日
- **優先度**: P2

#### 2. Firestore クエリの最適化
- **現状**: 一部のクエリでインデックスが不足
- **理想**: すべてのクエリが最適化されている
- **影響**: パフォーマンス低下、コスト増加
- **工数**: 2日
- **優先度**: P1

#### 3. エラーバウンダリの実装
- **現状**: グローバルなエラーハンドリングが不十分
- **理想**: すべての画面でエラーバウンダリを実装
- **影響**: アプリ全体のクラッシュ
- **工数**: 1日
- **優先度**: P1

### 中優先度

#### 4. 依存パッケージの更新
- **現状**: 一部のパッケージが古い
- **理想**: すべてのパッケージが最新
- **影響**: セキュリティリスク、新機能が使えない
- **工数**: 2日
- **優先度**: P2

#### 5. テストの充実
- **現状**: テストカバレッジ 60%
- **理想**: テストカバレッジ 80% 以上
- **影響**: バグの見逃し
- **工数**: 5日
- **優先度**: P2

#### 6. CI/CD の改善
- **現状**: ビルド時間が長い（15分）
- **理想**: ビルド時間 5分以内
- **影響**: 開発効率の低下
- **工数**: 2日
- **優先度**: P3

### 低優先度

#### 7. コードの整理
- **現状**: 一部のファイルが肥大化（1000行以上）
- **理想**: すべてのファイルが適切なサイズ（300行以下）
- **影響**: 可読性の低下
- **工数**: 3日
- **優先度**: P3

#### 8. ドキュメントの整備
- **現状**: API ドキュメントが不足
- **理想**: すべての public API にドキュメントがある
- **影響**: 開発効率の低下
- **工数**: 3日
- **優先度**: P3

---

## 将来の改善

### 機能追加

#### 1. オフラインモードの強化
- **内容**: 完全オフラインでの動作
- **メリット**: ネットワーク環境が悪い場所でも使用可能
- **工数**: 5日
- **優先度**: P4

#### 2. AI による習慣提案
- **内容**: ユーザーの行動パターンから習慣を提案
- **メリット**: ユーザーエンゲージメントの向上
- **工数**: 10日
- **優先度**: P4

#### 3. ソーシャル機能の拡張
- **内容**: グループ機能、ランキング機能
- **メリット**: ユーザー間の交流促進
- **工数**: 15日
- **優先度**: P4

### アーキテクチャ改善

#### 4. マイクロフロントエンド化
- **内容**: 機能ごとにモジュール分割
- **メリット**: 開発効率の向上、テストの容易化
- **工数**: 20日
- **優先度**: P4

#### 5. GraphQL の導入
- **内容**: REST API から GraphQL への移行
- **メリット**: データ取得の最適化
- **工数**: 15日
- **優先度**: P4

---

## 完了したタスク

### 2025年10月

#### P0
- [x] 認証フローの完成（2025-10-01）
- [x] データ同期の修正（2025-10-02）

#### P1
- [x] 色統一の実施（2025-09-28）
- [x] Riverpod エラー対策（2025-09-29）
- [x] BOTTOM OVERFLOWED 対策（2025-09-30）

#### P2
- [x] ボタン規格統一（2025-09-25）
- [x] カード様式統一（2025-09-26）
- [x] i18n 対応（2025-09-27）

### 2025年9月

#### P1
- [x] MiniQuest CRUD 機能（2025-09-20）
- [x] 進捗ログ機能（2025-09-22）
- [x] Stats 画面（2025-09-24）

#### P2
- [x] ペア機能の実装（2025-09-15）
- [x] プロフィール実データ化（2025-09-18）

---

## TODOコメントの管理

### コード内のTODOを検索

```bash
# すべてのTODOを検索
grep -r "TODO" lib/

# 優先度付きTODOを検索
grep -r "TODO(P0)" lib/
grep -r "TODO(P1)" lib/
grep -r "TODO(P2)" lib/
```

### TODOコメントの書き方

```dart
// 推奨される書き方
// TODO(P1): [担当者] 説明 - 期限: YYYY-MM-DD
// TODO(P1): [yamada] データ同期の最適化 - 期限: 2025-10-20

// 悪い例
// TODO: 後で直す
```

### TODOの定期レビュー

- **頻度**: 毎週月曜日
- **担当**: リードエンジニア
- **内容**:
  1. 新しいTODOの確認
  2. 期限切れTODOの確認
  3. 優先度の見直し
  4. 担当者の割り当て

---

## 技術的負債の返済計画

### 2025年Q4（10月-12月）

#### 10月
- [ ] Firestore クエリの最適化（P1）
- [ ] エラーバウンダリの実装（P1）
- [ ] 通知システムの改善（P1）

#### 11月
- [ ] データ同期の最適化（P1）
- [ ] エラーハンドリングの統一（P2）
- [ ] テストカバレッジの向上（P2）

#### 12月
- [ ] パフォーマンスの最適化（P2）
- [ ] 依存パッケージの更新（P2）
- [ ] コードの整理（P3）

### 2026年Q1（1月-3月）

#### 1月
- [ ] CI/CD の改善（P3）
- [ ] ドキュメントの整備（P3）

#### 2月-3月
- [ ] 将来の改善項目の検討

---

## メトリクス

### コード品質

```bash
# コードカバレッジ
flutter test --coverage
genhtml coverage/lcov.info -o coverage/html
open coverage/html/index.html

# 現在のカバレッジ: 60%
# 目標: 80%
```

### 技術的負債の指標

- **TODO コメント数**: 15件（目標: 5件以下）
- **コードの複雑度**: 平均 8（目標: 5以下）
- **重複コード**: 3%（目標: 1%以下）
- **テストカバレッジ**: 60%（目標: 80%以上）

---

## 参考リソース

- [技術的負債の管理](https://martinfowler.com/bliki/TechnicalDebt.html)
- [TODOコメントのベストプラクティス](https://stackoverflow.com/questions/1452934/what-is-the-proper-way-to-use-todo-comments)
- [コード品質の測定](https://www.sonarqube.org/)

---

## 更新履歴

- 2025-10-02: 初版作成
- 定期更新: 毎週月曜日
