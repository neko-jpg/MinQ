# Isar スキーマ凍結 & マイグレーション手順

v1 リリースでは `Quest` コレクションのスキーマを凍結し、破壊的変更を禁止します。以下の手順で変更管理と移行テストを実施します。

## 現行スキーマのスナップショット

- `test/isar_schema_snapshot_test.dart` で `QuestSchema` の version / property / index を検証し、差分が出た場合はテストが失敗します。
- スキーマを変更する場合は、テスト更新前に **マイグレーション計画** を下記テンプレートに沿って追記してください。

## マイグレーション変更フロー

1. 変更理由と影響範囲を記述する（例: フィールド追加、Enum 値追加）。
2. `isar_schema_migrations.md`（このファイル）に以下情報を追加する。
   - 変更日時・担当者
   - スキーマ差分（Before/After）
   - データ移行ステップ（バックアップ → マイグレーション → 検証）
   - ロールバック手順
3. `IsarService` にマイグレーションロジックを追加し、`flutter test` に移行テストを実装する。
4. テストが緑になることを確認後、`test/isar_schema_snapshot_test.dart` の期待値を更新する。

## リリース前チェックリスト

- [ ] 破壊的なフィールド削除や型変更がないことを diff で確認した
- [ ] テストで旧データ → 新データへの移行が成功することを確認した
- [ ] ロールバック手順をドキュメント化した

これらが完了した時点で `task.md` の「Isarスキーマ凍結」を完了済みに変更します。
