### AGENTS.md — MinQ (Flutter 習慣トラッカー) v1.1

> **目的** — 自律型AIエージェントが以下のタスクを実行できるようにすること。
>
> 1.  現在の**2,000件以上の`flutter analyze`エラー**をゼロになるまで段階的に修正する。
> 2.  `task.md`のチェックされていない項目ごとに、**本番用の実際のコード**を生成する（スタブは不可）。
> 3.  タスクが完了するたびに、**`task.md`を自動的に更新**する。

-----

### 1\. プロジェクト概要

MinQは、**Flutter 3.29.x**、Dart 3.x、Riverpod、Firebase、Freezedを使用して構築されたクロスプラットフォームの習慣トラッカーアプリです。
コードベースは**StrictMode**（`flutter analyze --fatal-infos --fatal-warnings`）でコンパイルする必要があり、**エラー0件 / 警告0件**を目指します。

-----

### 2\. セットアップコマンド
設定してある、セットアップコマンドを実行してください

-----

### 3\. ビルドとテストコマンド

| 目的 | コマンド |
| :--- | :--- |
| 静的解析 (致命的) | `flutter analyze --fatal-infos --fatal-warnings` |
| 単体テスト / ウィジェットテスト | `flutter test --coverage` |
| Golden画像差分承認 | `flutter test --update-goldens` (手動承認) |

エージェントは、すべてのチェックが合格するまで繰り返し作業しなければなりません。そうでなければPRは却下されます。

-----

### 4\. 初期クリーンアップエピック — 「2,000件以上の解析エラー」

#### エピックのトラッキング

`task.md`のトップレベルに以下のタスクを追加します。

```md
- [ ] 🔧 Lint-zeroキャンペーン (2,000件以上の解析エラーを修正)
```

#### 段階的な戦略

  - 安全な場合は`dart fix --apply`を使用しますが、`// ignore`による抑制は絶対に追加しないでください。
  - マージ後、CIが`flutter analyze`を再実行し、エラーが残っている場合は、次のサブタスクを自動的に開きます。

<!-- end list -->

```md
- [ ] 🔧 Lint-zeroステップ N/?? (残り: ####)
```

#### 完了条件

メインブランチで`flutter analyze`が0件の問題を報告したときのみ、このエピックは完了となります。

-----

### 5\. コーディングスタイルと実装ルール

| ルール | 実行 |
| :--- | :--- |
| ダミーコードの禁止 | `TODO`、`throw UnimplementedError()`、ハードコードされたプレースホルダーは禁止。 |
| モックの戻り値の禁止 | バックエンドが利用できない場合は、インターフェースを作成し、保留タスクとして追加します。モックを本番コードにマージしてはなりません。 |
| `const` / `final`の優先 | 可能な場合は`const`コンストラクタと`final`フィールドを使用します。 |
| フォーマット | コミットする前に`dart format --line-length 100 .`を実行します。 |
| カバレッジ | PRで変更された行は、80%以上のテストカバレッジが必要です。 |

-----

### 6\. タスクのワークフロー (AIコーディング回路)

1つのPR = `task.md`からの1つのタスク、またはIssue (`feature:` / `bug:`)です。

CIが合格した後：

  - チェックボックスを`[x]`に切り替え、SHAと日付を追記します。

<!-- end list -->

````md
- [x] 認証フロー実装 ```
- PRが追加作業を導入した場合、`### Pending`の下に項目を追加します。

#### PRのメタデータ
- タイトル: `[AI] feat(stats): bind streak chart`
- 本文: 変更点 / テスト / リスク / `task.md`の差分。

---

### 7. CI / CDパイプライン
```mermaid
graph TD
  T(task.mdの未チェック項目) --> |Webhook| W(AI Worker)
  W --> P(PR: コード + テスト)
  P --> C(CI: 解析 & テスト)
  C -- 合格 --> M(マージ & task.mdの更新)
  C -- 失敗 --> F(ログ付きのコメント) --> W
````

-----

### 8\. 開発環境の注意点

  - Flutterを`$HOME/flutter`に、Pubキャッシュを`~/.pub-cache`にキャッシュします（GitHub Actionsキャッシュ）。
  - テストにはFirebaseエミュレータを使用します。実際のキーはCIシークレット経由です (`FIREBASE_API_KEY`など)。
  - 複数のFlutterバージョンが必要になった場合は、fvmを導入します。

-----

### 9\. セキュリティ

  - シークレットはAI呼び出しに到達する前にマスクされます。
  - エージェントは`.env.*`や生のキーをコミットしてはなりません。

-----

### 10\. リリースパイプライン

`main`へのマージにより、以下がトリガーされます。

```bash
flutter build apk --release
flutter build ipa --no-codesign
```

生成物はドラフトのGitHub Releaseに添付され、手動でストアにアップロードされます。

-----

### 11\. 変更履歴

  - **v1.1 (2025-10-04)** — Lint-zeroエピック、厳格な実実装禁止、`task.md`の自動同期強化を追加。
  - **v1.0 (2025-10-04)** — 初版ドラフト。
