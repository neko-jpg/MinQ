# 機能実装リストと手順

## 機能実装リスト

### ペアリング機能
- [x] バディ検索ロジックの実装
- [x] 検索結果がない場合の通知登録機能

### バディ画面
- [x] バディリストのリアルタイム取得
- [x] 「拍手」機能
- [x] 「チェックイン」機能
- [x] バディのメニュー機能（ブロック・削除など）

### チャット機能
- [x] メッセージの送受信・保存
- [x] チャットのリアルタイム更新
- [x] メッセージへのリアクション機能

### 進捗共有機能
- [x] 進捗共有メッセージの送信
- [x] 写真の添付・アップロード機能
- [x] メモの添付機能

---

## 実装手順

### 1. チャット機能の実装 (メッセージ送受信)

**目標:** チャット画面でメッセージを送受信し、Firebase Firestoreに保存、リアルタイムで表示する。

**手順:**
1.  **データモデル定義:** `lib/domain/pair/` にメッセージデータを扱うための`ChatMessage`クラスを定義します。
2.  **Firestoreルール設定:** Firestoreのセキュリティルールを編集し、`pairs/{pairId}/messages` のようなサブコレクションへの読み書きを、そのペアのメンバーのみに許可するように設定します。
3.  **リポジトリ層の実装 (`pair_repository.dart`):**
    *   `sendMessage(String pairId, ChatMessage message)`: メッセージをFirestoreのサブコレクションに書き込むメソッドを実装します。
    *   `getMessagesStream(String pairId)`: 特定のチャットルームのメッセージをリアルタイムで購読する`Stream`を返すメソッドを実装します。
4.  **UIとロジックの接続 (`chat_screen.dart`):**
    *   現在ダミーデータを表示している`chatMessagesProvider`を、上記で作成した`getMessagesStream`を呼び出す`StreamProvider`に変更します。
    *   送信ボタンの`onPressed`処理で、入力されたテキストを`ChatMessage`オブジェクトとして`sendMessage`メソッドに渡す処理を実装します。

### 2. バディリストのリアルタイム取得

**目標:** `buddy_list_screen.dart`で、ログインしているユーザーが所属するバディのリストをFirestoreから取得し、リアルタイムで表示する。

**手順:**
1.  **リポジトリ層の実装 (`pair_repository.dart`):**
    *   `getBuddyListStream(String userId)`: 指定されたユーザーIDが含まれる`pairs`コレクションのドキュメントを購読する`Stream`を返すメソッドを実装します。
2.  **UIとロジックの接続 (`buddy_list_screen.dart`):**
    *   現在ダミーデータを表示している`buddyListProvider`を、上記で作成した`getBuddyListStream`を呼び出す`StreamProvider`に変更します。

### 3. ペアリング機能の実装

**目標:** `pair_matching_screen.dart`の検索機能を、実際のバックエンド（Firebase）と連携させる。

**手順:**
1.  **Cloud Functionsの実装:**
    *   ユーザーをマッチングさせるためのロジックを記述したCloud Function（例: `requestPair`) を作成します。この関数は、待機中のユーザーを探し、条件が合えば新しい`pair`ドキュメントを作成します。
2.  **リポジトリ層の実装 (`pair_repository.dart`):**
    *   `requestRandomPair(...)`メソッドから、上記で作成したCloud Functionを呼び出すように変更します。
3.  **UIとロジックの接続 (`pair_matching_screen.dart`):**
    *   現在のタイマーによるシミュレーションを削除し、`requestRandomPair`メソッドを呼び出すように変更します。
    *   `FutureBuilder`やRiverpodの`AsyncValue`を使い、関数の実行中・成功・失敗に応じてUI（検索中、成功、失敗）を切り替えます。
