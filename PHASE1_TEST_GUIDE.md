# フェーズ1 実機テストガイド

## テスト環境
- デバイス: A4010P
- コマンド: `flutter run`

## テスト前の準備

### 1. 依存関係の確認
```bash
flutter pub get
```

### 2. ビルドの確認
```bash
flutter analyze
```

### 3. 実機接続の確認
```bash
flutter devices
```

## テスト手順

### テスト1: AIコンシェルジュカード

**手順:**
1. アプリを起動
2. ログイン
3. ホーム画面を表示

**確認項目:**
- [ ] ホーム画面の上部に「Gemma AI」のカードが表示される
- [ ] 時間帯に応じたメッセージが表示される
- [ ] カードのデザインが適切（アイコン、色、レイアウト）
- [ ] ローディング状態が表示される（初回のみ）

**期待される動作:**
- 朝: 朝に関連したメッセージ
- 昼: 昼に関連したメッセージ
- 夜: 夜に関連したメッセージ

---

### テスト2: ゲーミフィケーションステータスカード

**手順:**
1. ホーム画面を表示

**確認項目:**
- [ ] AIコンシェルジュカードの下に「ゲーミフィケーション」カードが表示される
- [ ] 現在のランク（ブロンズ/シルバー/ゴールド/プラチナ/ダイヤモンド）が表示される
- [ ] 現在のポイント数が表示される
- [ ] 次のランクまでの進捗バーが表示される
- [ ] ランクアイコンが適切に表示される

**期待される動作:**
- 初回: ブロンズランク、0ポイント
- クエスト完了後: ポイントが増加

---

### テスト3: クエスト完了とポイント付与

**手順:**
1. クエストを作成
2. クエストを完了（記録）
3. ホーム画面に戻る

**確認項目:**
- [ ] クエスト完了時にポイントが付与される（50pt）
- [ ] ゲーミフィケーションカードのポイント数が更新される
- [ ] 進捗バーが更新される

**期待される動作:**
- 1回目の完了: 50pt
- 2回目の完了: 100pt
- 7日連続達成: 基本50pt + ストリークボーナス70pt = 120pt

---

### テスト4: ストリークボーナス

**手順:**
1. 7日間連続でクエストを完了（テスト用に日付を変更するか、実際に7日間テスト）
2. 8日目にクエストを完了

**確認項目:**
- [ ] 7日連続達成時に追加ポイントが付与される
- [ ] ボーナスポイント = ストリーク日数 × 10pt

**期待される動作:**
- 7日連続: 基本50pt + ボーナス70pt = 120pt
- 10日連続: 基本50pt + ボーナス100pt = 150pt

---

### テスト5: バッジ獲得

**手順:**
1. クエストを1回完了
2. クエストを10回完了
3. クエストを50回完了

**確認項目:**
- [ ] 1回完了: 「First Step」バッジ獲得
- [ ] 10回完了: 「Quest Apprentice」バッジ獲得
- [ ] 50回完了: 「Quest Journeyman」バッジ獲得
- [ ] バッジ獲得時に通知が表示される（実装予定）

**期待される動作:**
- バッジがFirestoreに保存される
- バッジ一覧画面で確認できる（実装予定）

---

### テスト6: ランクアップ

**手順:**
1. 1,000pt獲得（クエスト20回完了）
2. 5,000pt獲得（クエスト100回完了）

**確認項目:**
- [ ] 1,000pt到達: シルバーランクに昇格
- [ ] 5,000pt到達: ゴールドランクに昇格
- [ ] ランクアイコンが変更される
- [ ] ゲーミフィケーションカードが更新される

**期待される動作:**
- ブロンズ → シルバー → ゴールド → プラチナ → ダイヤモンド

---

### テスト7: ペアマッチング

**手順:**
1. ペア画面に移動
2. 「ランダムマッチング」をタップ
3. マッチング待機

**確認項目:**
- [ ] マッチング中の画面が表示される
- [ ] 30秒後にタイムアウトする（マッチング相手がいない場合）
- [ ] リトライボタンが機能する
- [ ] キャンセルボタンが機能する

**期待される動作:**
- マッチング相手がいる場合: マッチング成功画面 → ペア画面
- マッチング相手がいない場合: タイムアウト画面 → リトライ可能

---

### テスト8: クエスト作成後の導線

**手順:**
1. 「クエストを作成」をタップ
2. クエスト情報を入力
3. 「習慣を保存する」をタップ

**確認項目:**
- [ ] クエスト作成後、詳細画面に遷移する
- [ ] 詳細画面に「今すぐ開始」ボタンが表示される
- [ ] 「今すぐ開始」をタップすると記録画面に遷移する
- [ ] 「このクエストを記録する」ボタンも機能する

**期待される動作:**
- クエスト作成 → 詳細画面 → 記録画面
- スムーズな導線

---

## トラブルシューティング

### Gemma AIが動作しない場合
- `assets/models/gemma-2b-it-cpu.bin`が存在するか確認
- `pubspec.yaml`に`assets/models/`が追加されているか確認
- Gemma AIモデルのダウンロードが必要な場合がある

### ポイントが付与されない場合
- Firestoreの接続を確認
- `users/{uid}/points_transactions`コレクションを確認
- ログを確認: `Gamification: Awarded points and checked badges`

### ゲーミフィケーションカードが表示されない場合
- ユーザーがログインしているか確認
- Firestoreの権限を確認
- ログを確認

### ペアマッチングが動作しない場合
- Firestoreの`pair_queue`コレクションを確認
- Firestoreの権限を確認
- ネットワーク接続を確認

---

## 成功基準

以下の項目がすべて確認できればフェーズ1完了:

- [x] AIコンシェルジュカードが表示される
- [x] ゲーミフィケーションステータスカードが表示される
- [x] クエスト完了でポイント獲得
- [x] ストリークボーナスが付与される
- [x] バッジ獲得が記録される
- [x] ランクが正しく表示される
- [x] ペアマッチングが動作する
- [x] クエスト作成後の導線がスムーズ

---

## 次のステップ

すべてのテストが成功したら:
1. OKを出す
2. フェーズ2に進む

問題が見つかった場合:
1. 問題を報告
2. 修正
3. 再テスト
